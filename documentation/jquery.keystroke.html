<!DOCTYPE html>

<html>
<head>
  <title>jquery.keystroke.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="_.keystroke.html">
                _.keystroke.coffee
              </a>
            
              
              <a class="source" href="jquery.keystroke.html">
                jquery.keystroke.coffee
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>jquery.keystroke.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>( ( $ ) -&gt;
	$.fn.keyStroke = $.<span class="function"><span class="title">keyStroke</span></span> = ( requiredKeys, callback, options = {} ) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Defaults</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		options = $.extend
			context        : @
			args           : []
			preventDefault : <span class="literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>e.g. &#39;altKey&#39;, &#39;ctrlKey&#39;, &#39;metaKey&#39;, &#39;shiftKey&#39;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			modKeys        : []
		, options</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Cache the document object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		$document = $ document</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Keep track of pressed keys</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		activeKeys = []</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Keystroke-specific namespace, e.g. JQkeyStroke-67-ctrlKey</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		namespace = $.map [ requiredKeys, options.modKeys ], ( item ) -&gt;
			item
		.join <span class="string">'-'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Bind key listeners</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		$document.<span class="literal">on</span> <span class="string">"keydown.JQkeyStroke.JQkeyStroke-<span class="subst">#{namespace}</span>"</span>, ( event ) -&gt;
			activeKeys.push event.keyCode</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Uniquify activeKeys</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			activeKeys = activeKeys.filter ( item, index, array ) -&gt;
				index == $.inArray item, array

			executeCallback event <span class="keyword">if</span> checkKeystroke event

		$document.<span class="literal">on</span> <span class="string">"keyup.JQkeyStroke.JQkeyStroke-<span class="subst">#{namespace}</span>"</span>, ( event ) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Remove this key from activeKeys if it&#39;s in there</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			index = $.inArray event.keyCode, activeKeys
			activeKeys.splice index, <span class="number">1</span> <span class="keyword">if</span> index &gt; -<span class="number">1</span>

		<span class="function"><span class="title">executeCallback</span></span> = ( event ) -&gt;
			event.preventDefault() <span class="keyword">if</span> options.preventDefault
			callback.apply( options.context, [ event ].concat options.args )

		<span class="function"><span class="title">checkKeystroke</span></span> = ( event )-&gt;
			<span class="keyword">if</span> <span class="string">'array'</span> == $.type requiredKeys</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Make sure activeKeys and requiredKeys contain with exactly the same values, regardless of order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="number">0</span> == $( activeKeys ).<span class="keyword">not</span>( requiredKeys ).length == $( requiredKeys ).<span class="keyword">not</span>( activeKeys ).length
			<span class="keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Make sure the right number of keys are pressed and our target key is in it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="keyword">return</span> <span class="literal">false</span> <span class="keyword">unless</span> <span class="number">1</span> + options.modKeys.length == activeKeys.length
				<span class="keyword">return</span> <span class="literal">false</span> <span class="keyword">unless</span> $.inArray( requiredKeys, activeKeys ) &gt; -<span class="number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Make sure all of our mod keys are pressed
Since we know the target key is pressed and the count of keys is correct, this means
  no other mod keys are pressed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="keyword">for</span> modifier <span class="keyword">in</span> options.modKeys
					<span class="keyword">return</span> <span class="literal">false</span> <span class="keyword">unless</span> event[ modifier ]

				<span class="literal">true</span>

		@
) jQuery</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
